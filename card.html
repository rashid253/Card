<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>My Digital Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
:root{
 --primary:#2563eb;
 --dark:#0f172a;
 --muted:#475569;
 --bg:#f1f5f9;
}

*{box-sizing:border-box}

body{
 margin:0;
 font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
 background:var(--bg);
 color:var(--dark);
 line-height:1.6;
}

/* TOP BAR */
.topbar{
 display:flex;
 justify-content:space-around;
 padding:14px 0;
 background:var(--dark);
}
.topbar a{
 color:#fff;
 font-size:20px;
}

/* PROFILE */
.profile{
 position:relative;
 display:flex;
 gap:16px;
 padding:18px;
 background:#e2e8f0;
 align-items:center;
}

.profile img{
 width:110px;
 height:110px;
 aspect-ratio:1/1;
 border-radius:50%;
 object-fit:cover;
 object-position:center;
 border:3px solid var(--primary);
 background:#fff;
 flex-shrink:0;
}

.info{
 font-size:15px;
}

#name{
 font-weight:700;
 font-size:20px;
 margin-bottom:4px;
}

#business{
 font-size:16px;
 font-weight:600;
 color:var(--primary);
 margin-bottom:6px;
}

#phone,#email,#address{
 font-size:14px;
 color:var(--muted);
}

/* SAVE ICON */
.saveIcon{
 position:absolute;
 right:14px;
 bottom:14px;
 font-size:22px;
 color:var(--primary);
 cursor:pointer;
}

/* ABOUT */
.about{
 padding:14px 16px;
 background:#fff;
 font-size:15px;
}

/* BUSINESS BOX */
.businessBox{
 background:#fff;
 margin:14px;
 padding:14px;
 border-radius:14px;
 font-size:14px;
 box-shadow:0 2px 6px rgba(0,0,0,.05);
}
.businessBox h3{
 margin:0 0 10px 0;
 font-size:16px;
}

/* HOURS */
.hoursRow{
 display:flex;
 justify-content:space-between;
 padding:6px 0;
 font-size:14px;
 border-bottom:1px dashed #e5e7eb;
}
.hoursRow:last-child{border-bottom:none}
.closed{color:#dc2626;font-weight:600}
.open{color:#16a34a;font-weight:600}

/* SHOP CTA */
.ctaBar{
 margin:14px;
 padding:14px;
 border-radius:14px;
 background:linear-gradient(90deg,var(--primary),var(--dark));
 color:#fff;
 font-size:15px;
 font-weight:600;
 display:none;
 align-items:center;
 gap:12px;
 box-shadow:0 4px 12px rgba(0,0,0,.25);
 cursor:pointer;
}
.ctaBar img{
 width:42px;
 height:42px;
 border-radius:10px;
 object-fit:cover;
 background:#fff;
}

/* OFFERS */
.offers{
 display:flex;
 overflow-x:auto;
 scroll-snap-type:x mandatory;
}
.offer{
 min-width:90%;
 margin:14px;
 background:var(--primary);
 border-radius:18px;
 padding:14px;
 scroll-snap-align:center;
 color:#fff;
 display:flex;
 gap:14px;
 align-items:center;
}
.offer img{
 max-width:120px;
 max-height:100px;
 object-fit:contain;
 border-radius:10px;
 background:#fff;
}
.offerContent h3{
 margin:0 0 6px 0;
 font-size:17px;
}
.offerContent p{
 margin:0;
 font-size:14px;
}

/* DOTS */
.dots{text-align:center;margin-bottom:12px}
.dots span{
 display:inline-block;
 width:8px;
 height:8px;
 border-radius:50%;
 background:#94a3b8;
 margin:0 4px;
}
.dots .active{
 background:var(--primary);
 width:18px;
 border-radius:10px;
}

/* ACTIONS */
.actions{
 display:flex;
 justify-content:space-around;
 padding:16px 0;
 background:var(--dark);
}
.actions a{
 color:#fff;
 font-size:22px;
}

/* FLOATING SOCIAL */
.socialStack{
 position:fixed;
 right:14px;
 bottom:80px;
 width:48px;
 height:48px;
 border-radius:50%;
 background:var(--primary);
 color:#fff;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:20px;
 z-index:10;
 box-shadow:0 4px 12px rgba(0,0,0,.3);
}
.socialExpand{
 position:absolute;
 bottom:58px;
 right:0;
 display:none;
 flex-direction:column;
 gap:10px;
}
.socialExpand a{
 width:42px;
 height:42px;
 border-radius:50%;
 background:var(--dark);
 color:#fff;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:18px;
}
</style>
</head>

<body>

<div class="topbar">
 <a id="share"><i class="fa fa-share"></i></a>
 <a id="map"><i class="fa-solid fa-location-dot"></i></a>
 <a id="sms"><i class="fa fa-comment"></i></a>
</div>

<div class="profile">
 <img id="photo">
 <div class="info">
  <div id="name"></div>
  <div id="business"></div>
  <div id="phone"></div>
  <div id="email"></div>
  <div id="address"></div>
 </div>
 <i class="fa fa-floppy-disk saveIcon" onclick="saveCard()"></i>
</div>

<div class="about" id="about"></div>
<div class="businessBox" id="businessDetails" style="display:none"></div>
<div id="shopCTA" class="ctaBar"></div>

<div class="offers" id="offers"></div>
<div class="dots" id="dots"></div>

<div class="actions">
 <a id="call"><i class="fa fa-phone"></i></a>
 <a id="wa"><i class="fab fa-whatsapp"></i></a>
 <a id="mail"><i class="fa fa-envelope"></i></a>
</div>

<div class="socialStack" onclick="toggleSocial()">
 <i class="fab fa-facebook-f"></i>
 <div class="socialExpand" id="socialExpand">
  <a id="fb"><i class="fab fa-facebook-f"></i></a>
  <a id="ig"><i class="fab fa-instagram"></i></a>
  <a id="yt"><i class="fab fa-youtube"></i></a>
  <a id="web"><i class="fa fa-globe"></i></a>
 </div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const db = supabase.createClient(
 "https://dfvnefbxgayxqgjjgtrr.supabase.co",
 "sb_publishable_WypeFELCIlVDlqGY4PdWwA_snqoPUSE"
);

let id=new URLSearchParams(location.search).get("id")
 || localStorage.getItem("last_card_id");
if(!id){document.body.innerHTML="<h2>No card found</h2>";throw"";}

db.from("cards").select("*").eq("id",id).single().then(r=>{
 if(r.data) loadCard(JSON.parse(r.data.data));
});

function loadCard(data){
 photo.src=data.profileImage||"";
 name.textContent=data.name||"";
 business.textContent=data.businessName||"";
 phone.textContent="üìû "+(data.phone||"");
 email.textContent="‚úâÔ∏è "+(data.email||"");
 address.textContent="üìç "+(data.address||"");

 about.textContent=data.business?.about || data.businessInfo || "";

 call.href="tel:"+data.phone;
 wa.href="https://wa.me/"+data.phone;
 mail.href="mailto:"+data.email;
 map.href="https://maps.google.com/?q="+encodeURIComponent(data.address);
 sms.href="sms:"+data.phone;

 if(data.business?.hours){
  businessDetails.style.display="block";
  businessDetails.innerHTML="<h3>Business Hours</h3>";
  Object.keys(data.business.hours).forEach(day=>{
   const h=data.business.hours[day];
   businessDetails.innerHTML+=`
    <div class="hoursRow">
     <span>${day}</span>
     <span class="${h.open?'open':'closed'}">
      ${h.open ? `${h.from} ‚Äì ${h.to}` : 'Closed'}
     </span>
    </div>`;
  });
 }

 if(data.shopAppLink){
  shopCTA.style.display="flex";
  shopCTA.onclick=()=>location.href=data.shopAppLink;
  shopCTA.innerHTML=`
   ${data.shopAppImage?`<img src="${data.shopAppImage}">`:""}
   <div>Shop on our official app</div>`;
 }

 offers.innerHTML=""; dots.innerHTML="";
 data.offers?.forEach((o,i)=>{
  const d=document.createElement("div");
  d.className="offer";
  d.innerHTML=`
   ${o.image?`<img src="${o.image}">`:""}
   <div class="offerContent">
    <h3>üî• ${o.title}</h3>
    <p>${o.desc}</p>
   </div>`;
  d.onclick=()=>location.href="https://wa.me/"+data.phone;
  offers.appendChild(d);

  const dot=document.createElement("span");
  if(i==0) dot.classList.add("active");
  dots.appendChild(dot);
 });
}

function saveCard(){
 const vcf=`BEGIN:VCARD
VERSION:3.0
FN:${name.textContent}
TEL:${phone.textContent.replace("üìû ","")}
END:VCARD`;
 const a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([vcf],{type:"text/vcard"}));
 a.download="contact.vcf";a.click();
}

function toggleSocial(){
 socialExpand.style.display=
  socialExpand.style.display=="flex"?"none":"flex";
}
</script>

</body>
</html>
