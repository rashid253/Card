<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>My Digital Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
body{margin:0;font-family:system-ui;background:#f1f5f9;color:#0f172a}

.topbar{display:flex;justify-content:space-around;padding:12px;background:#0f172a}
.topbar a{color:white;font-size:20px}

.profile{position:relative;display:flex;gap:16px;padding:16px;background:#e2e8f0}
.profile img{
 width:110px;height:110px;
 border-radius:50%;
 object-fit:cover;
 aspect-ratio:1/1;
 border:3px solid #2563eb;
 background:white
}
.info{font-size:14px}
#name{font-weight:700;font-size:18px;margin-top:6px}
#business{font-size:16px;font-weight:600;margin-bottom:6px}

.saveIcon{
 position:absolute;
 right:14px;
 bottom:14px;
 font-size:22px;
 color:#2563eb;
 cursor:pointer;
}

/* BUSINESS INFO */
.about{
 padding:12px;
 background:white;
 font-size:14px;
 line-height:1.7;
 white-space:pre-line;
 position:relative;
}
.about.collapsed{
 max-height:140px;
 overflow:hidden;
}
.readMore{
 color:#2563eb;
 font-weight:600;
 cursor:pointer;
 margin:8px 12px;
 display:inline-block
}

/* SHOP CTA */
.ctaBar{
 margin:12px;
 padding:12px;
 border-radius:12px;
 background:linear-gradient(90deg,#2563eb,#0f172a);
 color:white;
 font-size:14px;
 font-weight:600;
 display:none;
 align-items:center;
 gap:10px;
 box-shadow:0 4px 10px rgba(0,0,0,.25);
 cursor:pointer
}
.ctaBar img{
 width:40px;height:40px;
 border-radius:8px;
 object-fit:cover;
 background:white
}

.offers{display:flex;overflow-x:auto;scroll-snap-type:x mandatory}
.offer{
 min-width:90%;
 margin:12px;
 background:#2563eb;
 border-radius:16px;
 padding:12px;
 scroll-snap-align:center;
 color:white;
 display:flex;
 gap:12px;
 align-items:center
}
.offer img{
 max-width:120px;
 max-height:100px;
 object-fit:contain;
 border-radius:8px;
 background:white
}
.offerContent{flex:1}
.offer button{
 width:auto;
 padding:6px 14px;
 border-radius:20px;
 border:1px solid white;
 background:transparent;
 color:white;
 font-size:13px;
 margin-top:8px
}

.dots{text-align:center;margin-bottom:10px}
.dots span{
 display:inline-block;
 width:8px;height:8px;
 border-radius:50%;
 background:#94a3b8;
 margin:0 4px
}
.dots .active{
 background:#2563eb;
 width:18px;
 border-radius:10px
}

.actions{
 display:flex;
 justify-content:space-around;
 padding:14px;
 background:#0f172a
}
.actions a{color:white;font-size:22px}

/* Floating Social */
.socialStack{
 position:fixed;
 right:14px;
 bottom:80px;
 width:46px;
 height:46px;
 border-radius:50%;
 background:#2563eb;
 color:white;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:20px;
 z-index:10;
 box-shadow:0 4px 12px rgba(0,0,0,.3)
}
.socialExpand{
 position:absolute;
 bottom:56px;
 right:0;
 display:none;
 flex-direction:column;
 gap:10px
}
.socialExpand a{
 width:40px;
 height:40px;
 border-radius:50%;
 background:#0f172a;
 color:white;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:18px
}
</style>
</head>

<body>

<div class="topbar">
<a id="share"><i class="fa fa-share"></i></a>
<a id="map"><i class="fa-solid fa-location-dot"></i></a>
<a id="sms"><i class="fa fa-comment"></i></a>
</div>

<div class="profile">
<img id="photo">
<div class="info">
<div id="name"></div>
<div id="business"></div>
<div id="phone"></div>
<div id="email"></div>
<div id="address"></div>
</div>
<i class="fa fa-floppy-disk saveIcon" onclick="saveCard()"></i>
</div>

<div class="about collapsed" id="about"></div>
<div class="readMore" id="readMore" onclick="toggleAbout()">Read more...</div>

<div id="shopCTA" class="ctaBar"></div>

<div class="offers" id="offers"></div>
<div class="dots" id="dots"></div>

<div class="actions">
<a id="call"><i class="fa fa-phone"></i></a>
<a id="wa"><i class="fab fa-whatsapp"></i></a>
<a id="mail"><i class="fa fa-envelope"></i></a>
</div>

<div class="socialStack" onclick="toggleSocial()">
 <i class="fab fa-facebook-f"></i>
 <div class="socialExpand" id="socialExpand">
  <a id="fb"><i class="fab fa-facebook-f"></i></a>
  <a id="ig"><i class="fab fa-instagram"></i></a>
  <a id="yt"><i class="fab fa-youtube"></i></a>
  <a id="web"><i class="fa fa-globe"></i></a>
 </div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const db = supabase.createClient(
 "https://dfvnefbxgayxqgjjgtrr.supabase.co",
 "sb_publishable_WypeFELCIlVDlqGY4PdWwA_snqoPUSE"
);

let id=new URLSearchParams(location.search).get("id")||localStorage.getItem("last_card_id");
if(!id){document.body.innerHTML="<h2>No card found</h2>";throw"";}
localStorage.setItem("last_card_id",id);

let cardData=null;

db.from("cards").select("*").eq("id",id).single().then(r=>{
 if(r.data) loadCard(JSON.parse(r.data.data));
});

function loadCard(data){
 cardData=data;

 photo.src=data.profileImage||"";
 name.textContent=data.name||"";
 business.textContent=data.businessName||"";
 phone.textContent="üìû "+(data.phone||"");
 email.textContent="‚úâÔ∏è "+(data.email||"");
 address.textContent="üìç "+(data.address||"");

 call.href="tel:"+data.phone;
 wa.href="https://wa.me/"+data.phone;
 mail.href="mailto:"+data.email;
 map.href="https://maps.google.com/?q="+encodeURIComponent(data.address);
 sms.href="sms:"+data.phone;

 if(data.facebook) fb.href=data.facebook;
 if(data.instagram) ig.href=data.instagram;
 if(data.youtube) yt.href=data.youtube;
 if(data.website) web.href=data.website;

 /* ===== GOOGLE MY BUSINESS STYLE BUSINESS INFO ===== */
 if(data.businessInfoFull){
  const b=data.businessInfoFull;
  let out=[];

  if(b.about) out.push(b.about+"\n");

  if(b.days && b.days.length){
   out.push("üìÖ Working Days:");
   out.push("‚úÖ "+b.days.join(", "));
  }

  if(b.is24){
   out.push("\nüïí Open 24 Hours");
  }else if(b.open && b.close){
   out.push(`\nüïí Timing: ${b.open} ‚Äì ${b.close}`);
  }

  if(b.holidays){
   out.push(`\n‚ùå Holidays: ${b.holidays}`);
  }

  if(b.services && b.services.length){
   out.push("\nüõ† Services:");
   b.services.forEach(s=>out.push("‚úÖ "+s));
  }

  if(b.payment && b.payment.length){
   out.push("\nüí≥ Payment Methods:");
   b.payment.forEach(p=>out.push("‚úÖ "+p));
  }

  if(b.established){
   out.push(`\nüè¢ Established: ${b.established}`);
  }

  about.textContent=out.join("\n");
 }

 if(about.scrollHeight<=140) readMore.style.display="none";
}

/* UI helpers */
function toggleAbout(){
 about.classList.toggle("collapsed");
 readMore.textContent=about.classList.contains("collapsed")?"Read more...":"Show less";
}
function toggleSocial(){
 socialExpand.style.display=socialExpand.style.display=="flex"?"none":"flex";
}
function saveCard(){
 const v=`BEGIN:VCARD\nFN:${cardData.name}\nTEL:${cardData.phone}\nEMAIL:${cardData.email}\nEND:VCARD`;
 const a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([v],{type:"text/vcard"}));
 a.download=cardData.name+".vcf";
 a.click();
}
share.onclick=()=>navigator.share?.({title:cardData.name,url:location.href});
</script>
</body>
</html>
