<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>My Digital Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
:root{--fs:15.5px;--lh:1.75}
*{box-sizing:border-box;}
body{
 margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
 font-size:var(--fs);line-height:var(--lh);
 background:#f1f5f9;color:#0f172a;
 padding-bottom:140px; /* safe bottom for actions */
}

/* TOPBAR */
.topbar{
 position:fixed;top:0;left:0;right:0;z-index:1000;
 display:flex;justify-content:space-around;padding:12px;
 background:#0f172a;
}
.topbar a{color:#fff;font-size:20px;}

/* PROFILE */
.profile{
 display:flex;gap:16px;padding:16px;margin-top:60px; /* below topbar */
 background:#e2e8f0;
 align-items:flex-start;position:relative;
}
.profile img{
 width:110px;height:110px;border-radius:50%;
 object-fit:cover;border:3px solid #2563eb;background:#fff;
}
.info{flex:1;display:flex;flex-direction:column;gap:4px}
#name{font-size:17px;font-weight:700}
#business{font-weight:600}
#phone,#email,#address{font-size:14px;opacity:.85}

/* SAVE ICON */
.saveIcon{
 position:absolute;right:14px;bottom:14px;
 font-size:22px;color:#2563eb;cursor:pointer
}

/* SHOP / BANNER */
.shopBanner{
 margin:12px;background:#2563eb;color:#fff;
 border-radius:12px;padding:14px;
 font-weight:600;text-align:center;
}

/* BADGES / CTA */
.ctaBar{
 margin:12px;padding:14px;border-radius:14px;
 background:linear-gradient(90deg,#2563eb,#0f172a);
 color:#fff;font-weight:600;display:flex;
 align-items:center;gap:12px;cursor:pointer;
 justify-content:center;
}
.ctaBar img{width:42px;height:42px;border-radius:10px;background:#fff}

/* BUSINESS HOURS */
.businessBox{background:#fff;margin:12px;padding:14px;border-radius:14px}
.hoursRow{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #e5e7eb}
.hoursRow:last-child{border-bottom:none}
.open{color:#16a34a;font-weight:600}
.closed{color:#dc2626;font-weight:600}

/* OFFERS */
.offers{
 display:flex;overflow-x:auto;scroll-snap-type:x mandatory;
 padding-bottom:12px;
}
.offer{
 min-width:260px; margin:12px; background:#fff;
 border-radius:18px; overflow:hidden; scroll-snap-align:center;
 box-shadow:0 6px 18px rgba(0,0,0,.12); flex-shrink:0;
 display:flex;flex-direction:column;
}
.offer img{
 width:100%; height:160px; object-fit:cover; display:block;
 background:#e5e7eb;
}
.offerContent{padding:12px}
.offerContent h3{margin:0 0 6px;font-size:16px}
.offerShort{opacity:.75;font-size:14px}

/* BUTTONS INSIDE OFFER MODAL */
.offerBtn{
 margin-top:10px;background:#2563eb;color:#fff;
 padding:10px;border-radius:10px;
 font-weight:700;text-align:center;cursor:pointer
}

/* ACTIONS */
.actions{
 display:flex;justify-content:space-around;
 padding:16px;background:#0f172a;position:fixed;bottom:0;left:0;right:0;
}
.actions a{color:#fff;font-size:22px}

/* SOCIAL */
.socialStack{
 position:fixed;right:14px;bottom:90px;
 width:48px;height:48px;border-radius:50%;
 background:#2563eb;color:#fff;
 display:flex;align-items:center;justify-content:center;
 box-shadow:0 4px 12px rgba(0,0,0,.3)
}
.socialExpand{
 position:absolute;bottom:58px;right:0;
 display:none;flex-direction:column;gap:10px
}
.socialExpand a{
 width:42px;height:42px;border-radius:50%;
 background:#0f172a;color:#fff;
 display:flex;align-items:center;justify-content:center
}
</style>
</head>

<body>

<!-- TOPBAR -->
<div class="topbar">
 <a id="share"><i class="fa fa-share"></i></a>
 <a id="map"><i class="fa-solid fa-location-dot"></i></a>
 <a id="sms"><i class="fa fa-comment"></i></a>
</div>

<!-- PROFILE -->
<div class="profile">
 <img id="photo">
 <div class="info">
  <div id="name"></div>
  <div id="business"></div>
  <div id="phone"></div>
  <div id="email"></div>
  <div id="address"></div>
 </div>
 <i class="fa fa-floppy-disk saveIcon" onclick="saveCard()"></i>
</div>

<!-- SHOP BANNER -->
<div class="shopBanner" id="shopBanner"></div>

<!-- BADGES / CTA -->
<div id="ctaBar" class="ctaBar" style="display:none"></div>

<!-- BUSINESS HOURS -->
<div class="businessBox" id="businessDetails" style="display:none"></div>

<!-- OFFERS -->
<div class="offers" id="offers"></div>

<!-- ACTIONS -->
<div class="actions">
 <a id="call"><i class="fa fa-phone"></i></a>
 <a id="wa"><i class="fab fa-whatsapp"></i></a>
 <a id="mail"><i class="fa fa-envelope"></i></a>
</div>

<!-- SOCIAL -->
<div class="socialStack" onclick="toggleSocial()">
 <i class="fab fa-facebook-f"></i>
 <div class="socialExpand" id="socialExpand">
  <a id="fb"><i class="fab fa-facebook-f"></i></a>
  <a id="ig"><i class="fab fa-instagram"></i></a>
  <a id="yt"><i class="fab fa-youtube"></i></a>
  <a id="web"><i class="fa fa-globe"></i></a>
 </div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const db=supabase.createClient(
 "https://dfvnefbxgayxqgjjgtrr.supabase.co",
 "sb_publishable_WypeFELCIlVDlqGY4PdWwA_snqoPUSE"
);

let id=new URLSearchParams(location.search).get("id")||localStorage.getItem("lastCardId");
if(!id){document.body.innerHTML="<h2>No card found</h2>";throw"";}

let sellerPhone="";
db.from("cards").select("*").eq("id",id).single().then(r=>{
 if(r.data) loadCard(JSON.parse(r.data.data));
});

function loadCard(data){
 sellerPhone=(data.phone||"").replace(/\D/g,"");

 photo.src=data.profileImage||"";
 name.textContent=data.name||"";
 business.textContent=data.businessName||"";
 phone.textContent="üìû "+(data.phone||"");
 email.textContent="‚úâÔ∏è "+(data.email||"");
 address.textContent="üìç "+(data.address||"");

 call.href="tel:"+data.phone;
 wa.href="https://wa.me/"+sellerPhone;
 mail.href="mailto:"+data.email;
 map.href="https://maps.google.com/?q="+encodeURIComponent(data.address);
 sms.href="sms:"+data.phone;

 /* SHOP BANNER */
 shopBanner.textContent=data.shopBanner||"üî• Black Friday 50% OFF! Limited time!";

 /* CTA BADGES */
 if(data.ctaBadges?.length){
  ctaBar.style.display="flex";
  ctaBar.innerHTML=data.ctaBadges.join(" ‚Ä¢ ");
 }

 /* BUSINESS HOURS */
 if(data.business?.hours){
  businessDetails.style.display="block";
  businessDetails.innerHTML="<h3>Business Hours</h3>";
  Object.keys(data.business.hours).forEach(d=>{
   const h=data.business.hours[d];
   businessDetails.innerHTML+=`
    <div class="hoursRow">
     <span>${d}</span>
     <span class="${h.open?'open':'closed'}">
      ${h.open?`${h.from} ‚Äì ${h.to}`:"Closed"}
     </span>
    </div>`;
  });
 }

 /* OFFERS */
 offers.innerHTML="";
 data.offers?.forEach(o=>{
  const d=document.createElement("div");
  d.className="offer";
  d.innerHTML=`
   <img src="${o.image||''}">
   <div class="offerContent">
    <h3>${o.title}</h3>
    <div class="offerShort">${o.desc.slice(0,60)}...</div>
    <div class="offerBtn" onclick="window.open('https://wa.me/${sellerPhone}?text=${encodeURIComponent('Hello, I am interested in '+o.title)}','_blank')">Get Offer on WhatsApp</div>
   </div>`;
  offers.appendChild(d);
 });
}

function saveCard(){/* same as before */ }
function toggleSocial(){socialExpand.style.display=socialExpand.style.display=="flex"?"none":"flex";}
</script>
</body>
</html>
