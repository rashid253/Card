<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>My Digital Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
body{margin:0;font-family:system-ui;background:#f1f5f9;color:#0f172a}

/* HEADER WITH CART */
.header {
  background: #0f172a;
  color: white;
  padding: 12px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 100;
}
.header h1 {
  margin: 0;
  font-size: 18px;
}
.cart-icon {
  position: relative;
  font-size: 20px;
  cursor: pointer;
}
.cart-count {
  position: absolute;
  top: -8px;
  right: -8px;
  background: #ef4444;
  color: white;
  border-radius: 50%;
  width: 18px;
  height: 18px;
  font-size: 12px;
  display: none;
  align-items: center;
  justify-content: center;
}

.profile{display:flex;gap:16px;padding:16px;background:#e2e8f0;position:relative}
.profile img{width:110px;height:110px;border-radius:50%;object-fit:cover;border:3px solid #2563eb;background:#fff}
.info{flex:1;display:flex;flex-direction:column;gap:4px}
#name{font-size:17px;font-weight:700}
#business{font-weight:600}
#phone,#email,#address,#websiteText{font-size:14px;opacity:.85}
.saveIcon{position:absolute;right:14px;bottom:14px;font-size:22px;color:#2563eb;cursor:pointer}
.about{background:#fff;padding:14px 16px;cursor:pointer}
.aboutText{overflow:hidden;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical}
.about.expanded .aboutText{-webkit-line-clamp:unset}
.aboutMore{color:#2563eb;font-weight:600;margin-top:6px;display:inline-block}

/* PRODUCTS/ OFFERS WITH BUY BUTTONS */
.offers{display:flex;gap:12px;padding:12px;overflow-x:auto}
.offer{
  min-width:160px;
  height:200px;
  border-radius:16px;
  background:#fff;
  position:relative;
  overflow:hidden;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
}
.offer img{width:100%;height:100%;object-fit:contain}
.offerBadges{position:absolute;top:10px;left:10px;display:flex;flex-direction:column;gap:6px}
.offerBadges span{background:#ef4444;color:#fff;font-size:12px;font-weight:700;padding:4px 8px;border-radius:8px}

/* Product Price & Buy Buttons */
.offer-footer {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(255,255,255,0.95);
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.price {
  display: flex;
  gap: 8px;
  align-items: center;
}
.original-price {
  text-decoration: line-through;
  color: #666;
  font-size: 12px;
}
.discount-price {
  color: #ef4444;
  font-weight: bold;
  font-size: 14px;
}
.buy-buttons {
  display: flex;
  gap: 8px;
}
.buy-now, .add-cart {
  flex: 1;
  padding: 6px;
  border: none;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
}
.buy-now {
  background: #16a34a;
  color: white;
}
.add-cart {
  background: #2563eb;
  color: white;
}

/* PRODUCT DETAIL PANEL */
#productPanel{
  position:fixed;
  inset:0;
  background:#fff;
  z-index:999;
  display:none;
  overflow-y:auto;
}
#productPanel img{width:100%;max-height:280px;object-fit:contain}
.panelContent{padding:16px}
.panelTitle{font-size:20px;font-weight:700;margin-bottom:8px}
.panelDesc{color:#666;margin-bottom:16px}
.panelPrice{font-size:24px;color:#16a34a;font-weight:700;margin:16px 0}

/* Payment Options in Panel */
.payment-options {
  margin: 20px 0;
  border-top: 1px solid #e2e8f0;
  padding-top: 20px;
}
.payment-option {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  padding: 12px;
  margin-bottom: 10px;
  cursor: pointer;
}
.payment-option.selected {
  background: #dbeafe;
  border-color: #2563eb;
}
.payment-option h4 {
  margin: 0 0 8px 0;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* CART MODAL */
.cart-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  z-index: 1000;
  display: none;
  justify-content: flex-end;
}
.cart-content {
  background: white;
  width: 100%;
  max-width: 400px;
  height: 100%;
  padding: 20px;
  overflow-y: auto;
}
.cart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 2px solid #e2e8f0;
}
.close-cart {
  background: #ef4444;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
}

/* CART ITEMS */
.cart-item {
  display: flex;
  gap: 12px;
  padding: 12px;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  margin-bottom: 10px;
}
.cart-item img {
  width: 60px;
  height: 60px;
  object-fit: cover;
  border-radius: 8px;
}
.cart-item-info {
  flex: 1;
}
.cart-item-title {
  font-weight: 600;
  margin-bottom: 4px;
}
.cart-item-price {
  color: #16a34a;
  font-weight: bold;
}
.cart-item-remove {
  background: #ef4444;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 4px 8px;
  cursor: pointer;
  font-size: 12px;
}

/* CHECKOUT */
.cart-total {
  margin-top: 20px;
  padding-top: 20px;
  border-top: 2px solid #e2e8f0;
  font-size: 18px;
  font-weight: bold;
  text-align: right;
}
.checkout-btn {
  width: 100%;
  padding: 14px;
  background: #16a34a;
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 600;
  margin-top: 20px;
  cursor: pointer;
}

/* Payment Receipt Upload */
.receipt-upload {
  margin: 20px 0;
  padding: 20px;
  background: #f8fafc;
  border-radius: 10px;
  border: 2px dashed #cbd5f5;
  text-align: center;
}
.receipt-upload input[type="file"] {
  display: none;
}
.upload-label {
  display: block;
  padding: 12px;
  background: #2563eb;
  color: white;
  border-radius: 8px;
  cursor: pointer;
}

.actions{display:flex;justify-content:space-around;padding:16px;background:#0f172a}
.actions a{color:#fff;font-size:22px}

/* Business Hours Styles */
.hoursContainer{background:#fff;padding:16px;margin-top:8px;}
.hoursContainer h3{margin:0 0 12px 0;font-size:16px;color:#0f172a;}
.dayRow{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f1f1f1;}
.dayRow:last-child{border-bottom:none;}
.dayName{font-weight:500;}
.dayTime{color:#666;}
.closed{color:#ef4444;}

/* Website Section */
.websiteContainer{background:#fff;padding:16px;margin-top:8px;}
.websiteContainer h3{margin:0 0 12px 0;font-size:16px;color:#0f172a;}
.websiteLink{display:flex;align-items:center;gap:10px;padding:12px;background:#f8fafc;border-radius:10px;text-decoration:none;color:#2563eb;font-weight:600;margin-top:8px;}
.websiteLink i{font-size:18px;}

/* Holidays Section */
.holidaysContainer{background:#fff;padding:16px;margin-top:8px;}
.holidaysContainer h3{margin:0 0 12px 0;font-size:16px;color:#0f172a;}
.holidayItem{display:flex;justify-content:space-between;align-items:center;padding:10px;background:#f8fafc;border-radius:8px;margin-bottom:8px;}
.holidayName{font-weight:500;color:#0f172a;}
.holidayDate{color:#ef4444;font-size:14px;}

/* Special Text for Website */
.websiteSpecial{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:white;padding:14px;border-radius:12px;margin:12px;text-align:center;font-weight:700;font-size:15px;}
.websiteSpecial a{color:white;text-decoration:none;}
</style>
</head>

<body>

<!-- HEADER WITH CART -->
<div class="header">
  <h1 id="businessHeader"></h1>
  <div class="cart-icon" onclick="openCart()">
    <i class="fas fa-shopping-cart"></i>
    <span class="cart-count" id="cartCount">0</span>
  </div>
</div>

<div class="profile">
 <img id="photo">
 <div class="info">
  <div id="name"></div>
  <div id="business"></div>
  <div id="phone"></div>
  <div id="email"></div>
  <div id="address"></div>
  <div id="websiteText"></div>
 </div>
 <i class="fa fa-floppy-disk saveIcon" onclick="saveCard()"></i>
</div>

<div class="about" id="aboutBox" onclick="toggleAbout()">
 <div class="aboutText" id="aboutText"></div>
 <span class="aboutMore" id="aboutMore">See more</span>
</div>

<!-- Website Section -->
<div class="websiteContainer" id="websiteContainer" style="display:none;">
 <h3>üåê Visit Our Website</h3>
 <a class="websiteLink" id="websiteLink" target="_blank" rel="noopener">
  <i class="fas fa-external-link-alt"></i>
  <span id="websiteUrl"></span>
 </a>
</div>

<!-- Business Hours Section -->
<div class="hoursContainer" id="hoursContainer" style="display:none;">
 <h3>üïê Business Hours</h3>
 <div id="businessHours"></div>
</div>

<!-- Holidays Section -->
<div class="holidaysContainer" id="holidaysContainer" style="display:none;">
 <h3>üìÖ Special Holidays</h3>
 <div id="holidaysList"></div>
</div>

<!-- Special Website Banner -->
<div class="websiteSpecial" id="websiteBanner" style="display:none;">
 <a id="websiteBannerLink" target="_blank" rel="noopener">
  üõí Shop Now on Our Online Store! Get Exclusive Offers! üåü
 </a>
</div>

<!-- PRODUCTS SECTION -->
<div class="offers" id="productsContainer"></div>

<div class="actions">
 <a id="call"><i class="fa fa-phone"></i></a>
 <a id="mail"><i class="fa fa-envelope"></i></a>
</div>

<!-- PRODUCT DETAIL PANEL -->
<div id="productPanel">
 <img id="panelImg">
 <div class="panelContent">
  <h2 class="panelTitle" id="panelTitle"></h2>
  <p class="panelDesc" id="panelDesc"></p>
  
  <div class="panelPrice" id="panelPrice"></div>
  
  <!-- Payment Options -->
  <div class="payment-options" id="paymentOptions" style="display:none;">
    <h3>üí≥ Select Payment Method</h3>
    <div class="payment-option" onclick="selectPaymentMethod('jazzcash')" id="jazzcashPayment">
      <h4>üí∞ JazzCash / EasyPaisa</h4>
      <p>Pay instantly via mobile wallet</p>
    </div>
    <div class="payment-option" onclick="selectPaymentMethod('cod')" id="codPayment">
      <h4>üì¶ Cash on Delivery</h4>
      <p>Pay cash when product is delivered</p>
    </div>
    
    <!-- Receipt Upload for JazzCash -->
    <div id="receiptSection" style="display:none;margin-top:20px;">
      <div class="receipt-upload">
        <h4>üì∏ Upload Payment Receipt</h4>
        <p>After payment, upload your JazzCash/EasyPaisa receipt</p>
        <input type="file" id="receiptFile" accept="image/*" onchange="uploadReceipt()">
        <label for="receiptFile" class="upload-label">üì§ Upload Receipt</label>
        <img id="receiptPreview" style="max-width:200px;margin-top:10px;display:none;">
      </div>
      <button onclick="confirmPayment()" style="width:100%;padding:12px;background:#16a34a;color:white;border:none;border-radius:8px;margin-top:10px;cursor:pointer;">
        ‚úÖ Confirm Payment
      </button>
    </div>
    
    <!-- WhatsApp for COD -->
    <div id="whatsappSection" style="display:none;margin-top:20px;">
      <div style="padding:15px;background:#d1fae5;border-radius:10px;">
        <h4>üì± Confirm Order via WhatsApp</h4>
        <p>Click below to confirm your COD order via WhatsApp</p>
        <button onclick="sendCODMessage()" style="width:100%;padding:12px;background:#25D366;color:white;border:none;border-radius:8px;margin-top:10px;cursor:pointer;">
          üìû WhatsApp Order
        </button>
      </div>
    </div>
  </div>
  
  <div style="display:flex;gap:10px;margin-top:20px;">
    <button class="buy-now" onclick="buyNow()" style="flex:1;padding:12px;font-size:16px;">üõí Buy Now</button>
    <button class="add-cart" onclick="addToCart(currentProduct)" style="flex:1;padding:12px;font-size:16px;">‚ûï Add to Cart</button>
  </div>
 </div>
</div>

<!-- CART MODAL -->
<div class="cart-modal" id="cartModal">
  <div class="cart-content">
    <div class="cart-header">
      <h2>üõí Your Cart</h2>
      <button class="close-cart" onclick="closeCart()">√ó</button>
    </div>
    
    <div id="cartItems"></div>
    
    <div class="cart-total">
      Total: PKR <span id="cartTotal">0</span>
    </div>
    
    <button class="checkout-btn" onclick="checkout()">
      üöÄ Proceed to Checkout
    </button>
  </div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
// Global variables
let card = {};
let currentProduct = null;
let cart = JSON.parse(localStorage.getItem('cart')) || [];
let selectedPaymentMethod = null;

// DOM Elements
const $ = id => document.getElementById(id);

// Cart functions
function updateCartCount() {
  const count = cart.length;
  $('cartCount').textContent = count;
  $('cartCount').style.display = count > 0 ? 'flex' : 'none';
}

function addToCart(product) {
  cart.push(product);
  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartCount();
  alert('‚úÖ Added to cart!');
}

function removeFromCart(index) {
  cart.splice(index, 1);
  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartCount();
  renderCart();
}

function openCart() {
  renderCart();
  $('cartModal').style.display = 'flex';
}

function closeCart() {
  $('cartModal').style.display = 'none';
}

function renderCart() {
  const cartItems = $('cartItems');
  cartItems.innerHTML = '';
  
  let total = 0;
  
  cart.forEach((item, index) => {
    const price = item.discountPrice || item.originalPrice || 0;
    total += parseFloat(price);
    
    const itemDiv = document.createElement('div');
    itemDiv.className = 'cart-item';
    itemDiv.innerHTML = `
      <img src="${item.image || ''}" onerror="this.style.display='none'">
      <div class="cart-item-info">
        <div class="cart-item-title">${item.title}</div>
        <div class="cart-item-price">PKR ${price}</div>
      </div>
      <button class="cart-item-remove" onclick="removeFromCart(${index})">√ó</button>
    `;
    cartItems.appendChild(itemDiv);
  });
  
  $('cartTotal').textContent = total.toFixed(2);
}

function checkout() {
  if (cart.length === 0) {
    alert('Your cart is empty!');
    return;
  }
  
  closeCart();
  // For now, just show WhatsApp message option
  sendOrderMessage();
}

// Payment methods
function selectPaymentMethod(method) {
  selectedPaymentMethod = method;
  
  // Remove selected class from all
  document.querySelectorAll('.payment-option').forEach(opt => {
    opt.classList.remove('selected');
  });
  
  // Add selected class to clicked one
  if (method === 'jazzcash') {
    $('jazzcashPayment').classList.add('selected');
    $('receiptSection').style.display = 'block';
    $('whatsappSection').style.display = 'none';
  } else if (method === 'cod') {
    $('codPayment').classList.add('selected');
    $('receiptSection').style.display = 'none';
    $('whatsappSection').style.display = 'block';
  }
}

function uploadReceipt() {
  const file = $('receiptFile').files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      $('receiptPreview').src = e.target.result;
      $('receiptPreview').style.display = 'block';
    };
    reader.readAsDataURL(file);
  }
}

function confirmPayment() {
  if (!selectedPaymentMethod) {
    alert('Please select a payment method first');
    return;
  }
  
  if (selectedPaymentMethod === 'jazzcash' && !$('receiptFile').files[0]) {
    alert('Please upload payment receipt first');
    return;
  }
  
  // Create order message
  const product = currentProduct;
  const message = `‚úÖ Order Confirmed!\n\nProduct: ${product.title}\nPrice: PKR ${product.discountPrice || product.originalPrice}\nPayment Method: ${selectedPaymentMethod === 'jazzcash' ? 'JazzCash/EasyPaisa' : 'Cash on Delivery'}\n\nThank you for your order!`;
  
  alert(message);
  
  // Close panel
  $('productPanel').style.display = 'none';
  
  // Clear cart if it was buy now
  if (!cart.some(item => item.title === product.title)) {
    // Send WhatsApp confirmation
    const phone = card.phone.replace(/\D/g, "");
    const whatsappMsg = encodeURIComponent(`Hi! I've just placed an order for:\n\nProduct: ${product.title}\nPrice: PKR ${product.discountPrice || product.originalPrice}\nPayment Method: ${selectedPaymentMethod}\n\nPlease confirm my order.`);
    window.open(`https://wa.me/${phone}?text=${whatsappMsg}`, '_blank');
  }
}

function sendCODMessage() {
  const product = currentProduct;
  const phone = card.phone.replace(/\D/g, "");
  const message = encodeURIComponent(`Hi! I want to place a COD order:\n\nProduct: ${product.title}\nPrice: PKR ${product.discountPrice || product.originalPrice}\n\nPlease confirm availability and delivery details.`);
  window.open(`https://wa.me/${phone}?text=${message}`, '_blank');
  
  // Close panel
  $('productPanel').style.display = 'none';
}

function sendOrderMessage() {
  const phone = card.phone.replace(/\D/g, "");
  let message = "Hi! I want to place an order:\n\n";
  
  cart.forEach((item, index) => {
    message += `${index + 1}. ${item.title} - PKR ${item.discountPrice || item.originalPrice}\n`;
  });
  
  message += `\nTotal: PKR ${$('cartTotal').textContent}\n\nPlease confirm my order.`;
  
  window.open(`https://wa.me/${phone}?text=${encodeURIComponent(message)}`, '_blank');
  
  // Clear cart after order
  cart = [];
  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartCount();
}

// Product functions
function buyNow() {
  $('paymentOptions').style.display = 'block';
}

// Main initialization
document.addEventListener("DOMContentLoaded", async ()=>{

const photo=$("photo"), nameEl=$("name"), businessEl=$("business"),
phoneEl=$("phone"), emailEl=$("email"), addressEl=$("address"), websiteText=$("websiteText"),
aboutText=$("aboutText"), aboutMore=$("aboutMore"), aboutBox=$("aboutBox"),
productsContainer=$("productsContainer"), call=$("call"), mail=$("mail"),
hoursContainer=$("hoursContainer"), businessHours=$("businessHours"),
holidaysContainer=$("holidaysContainer"), holidaysList=$("holidaysList"),
websiteContainer=$("websiteContainer"), websiteLink=$("websiteLink"), websiteUrl=$("websiteUrl"),
websiteBanner=$("websiteBanner"), websiteBannerLink=$("websiteBannerLink"),
panelImg=$("panelImg"), panelTitle=$("panelTitle"), panelDesc=$("panelDesc"),
panelPrice=$("panelPrice"), productPanel=$("productPanel");

const supa = supabase.createClient(
 "https://dfvnefbxgayxqgjjgtrr.supabase.co",
 "sb_publishable_WypeFELCIlVDlqGY4PdWwA_snqoPUSE"
);

const id=new URLSearchParams(location.search).get("id") || localStorage.getItem("lastCardId");
if(!id){document.body.innerHTML="<h2 style='padding:20px'>No card found</h2>";return;}

const {data,error}=await supa.from("cards").select("*").eq("id",id).single();
if(error || !data){document.body.innerHTML="<h2 style='padding:20px'>Card not found</h2>";return;}

card = JSON.parse(data.data);

// Update header
$('businessHeader').textContent = card.businessName || card.name || "Digital Card";

// Populate basic info
photo.src=card.profileImage||"";
nameEl.textContent=card.name||"";
businessEl.textContent=card.businessName||"";
phoneEl.textContent="üìû "+(card.phone||"");
emailEl.textContent="‚úâÔ∏è "+(card.email||"");
addressEl.textContent="üìç "+(card.address||"");
aboutText.textContent=card.business?.about||card.about||"";

// Website info
if(card.website && card.website.trim()) {
 websiteText.textContent="üåê " + card.website;
 websiteContainer.style.display="block";
 websiteUrl.textContent = card.website;
 websiteLink.href = card.website;
 websiteBanner.style.display="block";
 websiteBannerLink.href = card.website;
}

call.href="tel:"+card.phone;
mail.href="mailto:"+card.email;

// Business hours
if(card.businessHours && Array.isArray(card.businessHours) && card.businessHours.length > 0){
 hoursContainer.style.display = "block";
 const days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
 
 card.businessHours.forEach((day, index) => {
   if(day && day.open !== undefined) {
     const dayDiv = document.createElement("div");
     dayDiv.className = "dayRow";
     
     if(!day.open || day.status === 'closed') {
       dayDiv.innerHTML = `
         <span class="dayName">${days[index]}</span>
         <span class="dayTime closed">Closed</span>
       `;
     } else {
       dayDiv.innerHTML = `
         <span class="dayName">${days[index]}</span>
         <span class="dayTime">${day.start} - ${day.end}</span>
       `;
     }
     
     businessHours.appendChild(dayDiv);
   }
 });
}

// Holidays
if(card.holidays && Array.isArray(card.holidays) && card.holidays.length > 0){
 holidaysContainer.style.display = "block";
 
 card.holidays.forEach(holiday => {
   if(holiday.name && holiday.date) {
     const holidayDiv = document.createElement("div");
     holidayDiv.className = "holidayItem";
     
     const date = new Date(holiday.date);
     const formattedDate = date.toLocaleDateString('en-US', {
       month: 'short',
       day: 'numeric',
       year: 'numeric'
     });
     
     holidayDiv.innerHTML = `
       <span class="holidayName">${holiday.name}</span>
       <span class="holidayDate">${formattedDate}</span>
     `;
     
     holidaysList.appendChild(holidayDiv);
   }
 });
}

// Populate products
productsContainer.innerHTML="";
(card.products||card.offers||[]).forEach(p=>{
 if(!p.title && !p.image) return;
 
 const productDiv=document.createElement("div");
 productDiv.className="offer";
 
 const price = p.discountPrice || p.originalPrice;
 
 productDiv.innerHTML=`
  <img src="${p.image||''}" onerror="this.style.display='none'">
  <div class="offerBadges">${(p.badges||[]).map(b=>`<span>${b}</span>`).join("")}</div>
  <div class="offer-footer">
    <div class="price">
      ${p.originalPrice ? `<span class="original-price">PKR ${p.originalPrice}</span>` : ''}
      ${price ? `<span class="discount-price">PKR ${price}</span>` : ''}
    </div>
    <div class="buy-buttons">
      <button class="buy-now" onclick="showProductDetails(${JSON.stringify(p).replace(/"/g, '&quot;')})">Buy Now</button>
      <button class="add-cart" onclick="addToCart(${JSON.stringify(p).replace(/"/g, '&quot;')})">Add Cart</button>
    </div>
  </div>
 `;
 
 productsContainer.appendChild(productDiv);
});

// If no products, hide section
if((card.products||card.offers||[]).length === 0) {
 productsContainer.style.display = "none";
}

window.toggleAbout=()=>{
 aboutBox.classList.toggle("expanded");
 aboutMore.textContent=aboutBox.classList.contains("expanded")?"See less":"See more";
};

window.saveCard=()=>{
 const vcard = `BEGIN:VCARD
VERSION:3.0
FN:${card.name}
ORG:${card.businessName}
TEL:${card.phone}
EMAIL:${card.email}
ADR:${card.address}
URL:${card.website||''}
NOTE:${card.business?.about||''}
END:VCARD`;

 const blob = new Blob([vcard], { type: 'text/vcard' });
 const url = URL.createObjectURL(blob);
 const a = document.createElement('a');
 a.href = url;
 a.download = `${card.name.replace(/\s+/g, '_')}_contact.vcf`;
 document.body.appendChild(a);
 a.click();
 document.body.removeChild(a);
 URL.revokeObjectURL(url);
 
 alert("Contact saved as vCard file!");
};

// Show product details
window.showProductDetails = function(product) {
  currentProduct = product;
  
  panelImg.src = product.image || '';
  panelTitle.textContent = product.title || '';
  panelDesc.textContent = product.desc || '';
  
  const price = product.discountPrice || product.originalPrice;
  panelPrice.textContent = price ? `PKR ${price}` : '';
  
  // Hide payment options initially
  $('paymentOptions').style.display = 'none';
  $('receiptSection').style.display = 'none';
  $('whatsappSection').style.display = 'none';
  selectedPaymentMethod = null;
  
  productPanel.style.display = "block";
};

// Close product panel
productPanel.onclick = (e) => {
 if(e.target === productPanel) {
  productPanel.style.display = "none";
 }
};

// Initialize cart count
updateCartCount();
});
</script>
</body>
</html>
