<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Digital Business Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
 margin:0;
 font-family:system-ui;
 background:#f1f5f9;
}

.topbar{
 background:#111827;
 color:white;
 padding:12px;
 display:flex;
 justify-content:space-around;
 font-size:20px;
}

.topbar a{
 color:white;
 text-decoration:none;
}

.main{
 max-width:500px;
 margin:auto;
}

.profile-card{
 background:white;
 margin:15px;
 border-radius:18px;
 padding:15px;
}

.profile{
 display:flex;
 gap:15px;
 align-items:center;
}

.profile img{
 width:100px;
 height:100px;
 border-radius:50%;
 object-fit:cover;
 border:3px solid #e5e7eb;
}

.info h2{
 margin:0;
 font-size:22px;
}

.info p{
 margin:4px 0;
 color:#374151;
}

.actions{
 display:flex;
 justify-content:space-around;
 margin-top:10px;
}

.actions a{
 background:#2563eb;
 color:white;
 padding:8px 12px;
 border-radius:8px;
 font-size:14px;
 text-decoration:none;
}

.about{
 margin-top:10px;
 color:#374151;
}

.offers-title{
 margin:15px;
 font-weight:bold;
 font-size:18px;
}

.offers{
 display:flex;
 overflow-x:auto;
 gap:12px;
 padding:15px;
}

.offer{
 min-width:240px;
 background:white;
 border-radius:14px;
 padding:10px;
}

.offer img{
 width:100%;
 height:140px;
 border-radius:10px;
 object-fit:cover;
}

.offer h4{
 margin:8px 0 4px 0;
}

.offer p{
 font-size:14px;
 color:#374151;
}

.offer button{
 width:100%;
 margin-top:6px;
 padding:10px;
 border:none;
 border-radius:8px;
 background:#16a34a;
 color:white;
 font-size:14px;
}
</style>
</head>

<body>

<div class="topbar">
 <a id="shareBtn">üîó</a>
 <a id="callBtn">üìû</a>
 <a id="waBtn">üí¨</a>
 <a id="mapBtn">üìç</a>
 <a id="dirBtn">üß≠</a>
</div>

<div class="main">

 <div class="profile-card">
  <div class="profile">
   <img id="profileImg">
   <div class="info">
    <h2 id="name"></h2>
    <p id="businessName"></p>
    <p id="address"></p>
   </div>
  </div>

  <div class="actions">
   <a id="callBtn2">Call</a>
   <a id="waBtn2">WhatsApp</a>
   <a id="mapBtn2">Map</a>
  </div>

  <div class="about" id="businessInfo"></div>
 </div>

 <div class="offers-title">Offers</div>
 <div class="offers" id="offers"></div>

</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const db = supabase.createClient(
 "https://dfvnefbxgayxqgjjgtrr.supabase.co",
 "sb_publishable_WypeFELCIlVDlqGY4PdWwA_snqoPUSE"
);

const id = new URLSearchParams(location.search).get("id");

db.from("cards").select("*").eq("id",id).single().then(r=>{
 const d = JSON.parse(r.data.data);

 // Safe assignments (no undefined)
 name.innerText = d.name || "";
 businessName.innerText = d.businessName || "";
 address.innerText = d.address || "";
 businessInfo.innerText = d.businessInfo || "";
 profileImg.src = d.profileImage || "https://via.placeholder.com/100";

 const phone = d.phone || "";

 callBtn.href = "tel:"+phone;
 callBtn2.href = "tel:"+phone;
 waBtn.href = "https://wa.me/"+phone;
 waBtn2.href = "https://wa.me/"+phone;
 mapBtn.href = "https://maps.google.com?q="+encodeURIComponent(d.address || "");
 mapBtn2.href = mapBtn.href;
 dirBtn.href = "https://www.google.com/maps/dir/?api=1&destination="+encodeURIComponent(d.address || "");
 shareBtn.onclick = ()=>navigator.share({url:location.href});

 if(d.offers && d.offers.length){
  d.offers.forEach(o=>{
   const div = document.createElement("div");
   div.className = "offer";
   div.innerHTML = `
    <img src="${o.image || 'https://via.placeholder.com/300x140'}">
    <h4>${o.title || ""}</h4>
    <p>${o.desc || ""}</p>
    <button onclick="location.href='https://wa.me/${phone}?text=${encodeURIComponent(o.title || '')}'">
     Get Offer
    </button>
   `;
   offers.appendChild(div);
  });
 }
});
</script>

</body>
</html>
