<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>My Digital Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
body{margin:0;font-family:system-ui;background:#f1f5f9;color:#0f172a}

/* HEADER */
.topbar{
 display:flex;
 justify-content:space-around;
 align-items:center;
 padding:12px;
 background:#0f172a
}
.topbar a{color:#fff;font-size:20px}

/* PROFILE */
.profile{
 display:flex;
 gap:16px;
 padding:16px;
 background:#e2e8f0;
 position:relative
}
.profile img{
 width:110px;
 height:110px;
 border-radius:50%;
 object-fit:cover;
 border:3px solid #2563eb;
 background:#fff
}
.info{flex:1;display:flex;flex-direction:column;gap:4px}
#name{font-size:17px;font-weight:700}
#business{font-weight:600}
#phone,#email,#address,#websiteText{font-size:14px;opacity:.85}
.saveIcon{
 position:absolute;
 right:14px;
 bottom:14px;
 font-size:22px;
 color:#2563eb;
 cursor:pointer
}

/* ABOUT */
.about{background:#fff;padding:14px 16px;cursor:pointer}
.aboutText{
 overflow:hidden;
 display:-webkit-box;
 -webkit-line-clamp:3;
 -webkit-box-orient:vertical
}
.about.expanded .aboutText{-webkit-line-clamp:unset}
.aboutMore{color:#2563eb;font-weight:600;margin-top:6px;display:inline-block}

/* WEBSITE / HOURS / HOLIDAYS */
.websiteContainer,.hoursContainer,.holidaysContainer{
 background:#fff;
 padding:16px;
 margin-top:8px
}
.dayRow{
 display:flex;
 justify-content:space-between;
 padding:8px 0;
 border-bottom:1px solid #eee
}
.dayRow:last-child{border-bottom:none}
.closed{color:#ef4444}

/* WEBSITE BANNER */
.websiteSpecial{
 background:linear-gradient(135deg,#667eea,#764ba2);
 color:#fff;
 padding:14px;
 border-radius:12px;
 margin:12px;
 text-align:center;
 font-weight:700
}
.websiteSpecial a{color:#fff;text-decoration:none}

/* OFFERS */
.offers{
 display:flex;
 gap:12px;
 padding:12px;
 overflow-x:auto
}
.offer{
 min-width:160px;
 height:200px;
 border-radius:16px;
 background:#fff;
 position:relative;
 overflow:hidden;
 cursor:pointer
}
.offer img{width:100%;height:100%;object-fit:contain}
.offerBadges{
 position:absolute;
 top:10px;
 left:10px;
 display:flex;
 flex-direction:column;
 gap:6px
}
.offerBadges span{
 background:#ef4444;
 color:#fff;
 font-size:12px;
 font-weight:700;
 padding:4px 8px;
 border-radius:8px
}

/* OFFER PANEL */
#offerPanel{
 position:fixed;
 inset:0;
 background:#fff;
 z-index:999;
 display:none
}
#offerPanel img{width:100%;max-height:280px;object-fit:contain}
.panelContent{padding:16px}
.panelCTA{
 margin-top:16px;
 background:#16a34a;
 color:#fff;
 padding:16px;
 text-align:center;
 border-radius:12px;
 font-weight:700;
 cursor:pointer
}

/* FOOTER */
.actions{
 display:flex;
 justify-content:space-around;
 align-items:center;
 padding:16px;
 background:#0f172a
}
.actions a{color:#fff;font-size:22px}
</style>
</head>

<body>

<!-- HEADER -->
<div class="topbar">
 <a id="map"><i class="fa-solid fa-location-dot"></i></a>
 <a id="sms"><i class="fa-solid fa-comment"></i></a>
 <a id="share"><i class="fa-solid fa-share-nodes"></i></a>
</div>

<!-- PROFILE -->
<div class="profile">
 <img id="photo">
 <div class="info">
  <div id="name"></div>
  <div id="business"></div>
  <div id="phone"></div>
  <div id="email"></div>
  <div id="address"></div>
  <div id="websiteText"></div>
 </div>
 <i class="fa fa-floppy-disk saveIcon" onclick="saveCard()"></i>
</div>

<!-- ABOUT -->
<div class="about" id="aboutBox" onclick="toggleAbout()">
 <div class="aboutText" id="aboutText"></div>
 <span class="aboutMore" id="aboutMore">See more</span>
</div>

<div class="websiteContainer" id="websiteContainer" style="display:none;">
 <h3>üåê Visit Our Website</h3>
 <a id="websiteLink" target="_blank">
  <i class="fa-solid fa-globe"></i>
  <span id="websiteUrl"></span>
 </a>
</div>

<div class="hoursContainer" id="hoursContainer" style="display:none;">
 <h3>üïê Business Hours</h3>
 <div id="businessHours"></div>
</div>

<div class="holidaysContainer" id="holidaysContainer" style="display:none;">
 <h3>üìÖ Special Holidays</h3>
 <div id="holidaysList"></div>
</div>

<div class="websiteSpecial" id="websiteBanner" style="display:none;">
 <a id="websiteBannerLink" target="_blank">
  üõí Shop Now on Our Online Store
 </a>
</div>

<div class="offers" id="offers"></div>

<!-- FOOTER -->
<div class="actions">
 <a id="call"><i class="fa fa-phone"></i></a>
 <a id="footerSms"><i class="fa fa-comment"></i></a>
 <a id="whatsapp"><i class="fa-brands fa-whatsapp"></i></a>
 <a id="mail"><i class="fa fa-envelope"></i></a>
</div>

<div id="offerPanel">
 <img id="panelImg">
 <div class="panelContent">
  <h2 id="panelTitle"></h2>
  <p id="panelDesc"></p>
  <div class="panelCTA" id="panelCTA">WhatsApp</div>
 </div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
document.addEventListener("DOMContentLoaded", async ()=>{

const $=id=>document.getElementById(id);

const supa=supabase.createClient(
 "https://dfvnefbxgayxqgjjgtrr.supabase.co",
 "sb_publishable_WypeFELCIlVDlqGY4PdWwA_snqoPUSE"
);

const id=new URLSearchParams(location.search).get("id")||localStorage.getItem("lastCardId");
if(!id){document.body.innerHTML="<h2 style='padding:20px'>No card found</h2>";return;}

const {data}=await supa.from("cards").select("*").eq("id",id).single();
if(!data){document.body.innerHTML="<h2 style='padding:20px'>Card not found</h2>";return;}

const card=JSON.parse(data.data);

$("photo").src=card.profileImage||"";
$("name").textContent=card.name||"";
$("business").textContent=card.businessName||"";
$("phone").textContent="üìû "+(card.phone||"");
$("email").textContent="‚úâÔ∏è "+(card.email||"");
$("address").textContent="üìç "+(card.address||"");
$("aboutText").textContent=card.business?.about||card.about||"";

$("call").href="tel:"+card.phone;
$("mail").href="mailto:"+card.email;
$("sms").href="sms:"+card.phone;
$("footerSms").href="sms:"+card.phone;
$("whatsapp").href=`https://wa.me/${card.phone.replace(/\D/g,"")}`;
$("map").href="https://maps.google.com/?q="+encodeURIComponent(card.address);

/* SHARE */
$("share").onclick=()=>{
 const url=location.href;
 if(navigator.share){
  navigator.share({title:card.name,text:card.businessName,url});
 }else{
  navigator.clipboard.writeText(url);
  alert("Link copied");
 }
};

window.toggleAbout=()=>{
 $("aboutBox").classList.toggle("expanded");
 $("aboutMore").textContent=
  $("aboutBox").classList.contains("expanded")?"See less":"See more";
};

window.saveCard=()=>{
 const v=`BEGIN:VCARD
VERSION:3.0
FN:${card.name}
ORG:${card.businessName}
TEL:${card.phone}
EMAIL:${card.email}
ADR:${card.address}
END:VCARD`;
 const b=new Blob([v],{type:"text/vcard"});
 const a=document.createElement("a");
 a.href=URL.createObjectURL(b);
 a.download="contact.vcf";
 a.click();
};

});
</script>

</body>
</html>
