<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Digital Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
/* پورا CSS وہی ہے جو آپ نے پہلے دیا تھا */
:root {
 --primary: #2563eb;
 --success: #10b981;
 --danger: #ef4444;
 --warning: #f59e0b;
 --dark: #0f172a;
 --light: #f8fafc;
}

body{
 margin:0;
 font-family:system-ui, -apple-system, sans-serif;
 background:#f1f5f9;
 color:#0f172a;
 min-height:100vh;
}
*{box-sizing:border-box}

/* Header */
.topbar{
 display:flex;
 justify-content:space-around;
 padding:12px;
 background:var(--dark);
 position:sticky;
 top:0;
 z-index:100;
}
.topbar a{
 color:#fff;
 font-size:20px;
 text-decoration:none;
 display:flex;
 align-items:center;
 justify-content:center;
 width:44px;
 height:44px;
 border-radius:50%;
 transition:background 0.3s;
 cursor:pointer;
}
.topbar a:hover{
 background:rgba(255,255,255,0.1);
}

/* Profile Section */
.profile{
 display:flex;
 gap:16px;
 padding:20px;
 background:#e2e8f0;
 position:relative;
 align-items:center;
}
.profile img{
 width:100px;
 height:100px;
 border-radius:50%;
 object-fit:cover;
 border:3px solid var(--primary);
 background:#fff;
 flex-shrink:0;
}
.info{
 flex:1;
 display:flex;
 flex-direction:column;
 gap:6px;
}
#name{
 font-size:18px;
 font-weight:700;
 color:var(--dark);
 margin-bottom:2px;
}
#business{
 font-weight:600;
 color:var(--primary);
 margin-bottom:4px;
}
#phone, #email, #address, #websiteText{
 font-size:14px;
 color:#475569;
 display:flex;
 align-items:center;
 gap:8px;
}
.saveIcon{
 position:absolute;
 right:20px;
 bottom:20px;
 font-size:22px;
 color:var(--primary);
 cursor:pointer;
 background:white;
 width:44px;
 height:44px;
 border-radius:50%;
 display:flex;
 align-items:center;
 justify-content:center;
 box-shadow:0 2px 8px rgba(0,0,0,0.1);
 transition:transform 0.2s;
}
.saveIcon:hover{transform:scale(1.1)}

/* About Section */
.about{
 background:#fff;
 padding:16px;
 margin:8px;
 border-radius:12px;
 box-shadow:0 1px 3px rgba(0,0,0,0.1);
}
.aboutText{
 overflow:hidden;
 display:-webkit-box;
 -webkit-line-clamp:3;
 -webkit-box-orient:vertical;
 line-height:1.5;
}
.about.expanded .aboutText{-webkit-line-clamp:unset}
.aboutMore{
 color:var(--primary);
 font-weight:600;
 margin-top:8px;
 display:inline-block;
 cursor:pointer;
}

/* Sections */
.section{
 background:#fff;
 padding:16px;
 margin:8px;
 border-radius:12px;
 box-shadow:0 1px 3px rgba(0,0,0,0.1);
}
.section h3{
 margin:0 0 12px 0;
 font-size:16px;
 color:var(--dark);
 display:flex;
 align-items:center;
 gap:8px;
}

/* Offers */
.offers{
 display:flex;
 gap:12px;
 padding:12px;
 overflow-x:auto;
}
.offer{
 min-width:180px;
 height:220px;
 border-radius:16px;
 background:#fff;
 position:relative;
 cursor:pointer;
 overflow:hidden;
 box-shadow:0 2px 8px rgba(0,0,0,0.1);
 flex-shrink:0;
}
.offer img{
 width:100%;
 height:100%;
 object-fit:cover;
}
.offerBadges{
 position:absolute;
 top:10px;
 left:10px;
 display:flex;
 flex-direction:column;
 gap:6px;
}
.offerBadges span{
 background:var(--danger);
 color:#fff;
 font-size:11px;
 font-weight:700;
 padding:3px 6px;
 border-radius:6px;
}
.offerOverlay{
 position:absolute;
 bottom:0;
 left:0;
 right:0;
 background:linear-gradient(transparent, rgba(0,0,0,0.8));
 padding:12px;
 color:white;
}
.offerTitle{
 font-weight:600;
 font-size:14px;
 margin-bottom:4px;
}
.offerPrice{
 display:flex;
 align-items:center;
 gap:8px;
 font-size:13px;
}
.offerPrice .current{
 font-weight:700;
 font-size:16px;
}
.offerPrice .original{
 text-decoration:line-through;
 opacity:0.7;
 font-size:12px;
}
.offerActions{
 display:flex;
 gap:6px;
 margin-top:8px;
}
.offerActionBtn{
 padding:6px 12px;
 background:var(--primary);
 color:white;
 border-radius:8px;
 font-size:12px;
 font-weight:600;
 cursor:pointer;
 border:none;
 flex:1;
 text-align:center;
}
.offerActionBtn.shop{background:var(--success)}

/* WhatsApp Note */
.whatsappNote{
 background:#fff;
 padding:14px;
 margin:12px;
 border-radius:12px;
 border-left:4px solid #25d366;
 font-size:14px;
 color:var(--dark);
}
.whatsappNote strong{color:#25d366;}

/* Business Hours */
.dayRow{
 display:flex;
 justify-content:space-between;
 padding:10px 0;
 border-bottom:1px solid #e2e8f0;
 align-items:center;
}
.dayRow:last-child{border-bottom:none}
.dayName{font-weight:500;}
.dayTime{color:#475569;font-size:14px;}
.closed{color:var(--danger);}

/* Holidays */
.holidayItem{
 display:flex;
 justify-content:space-between;
 align-items:center;
 padding:10px;
 background:#f8fafc;
 border-radius:8px;
 margin-bottom:8px;
}
.holidayName{font-weight:500;}
.holidayDate{color:var(--danger);font-size:13px;}

/* Website Link */
.websiteLink{
 display:flex;
 align-items:center;
 gap:10px;
 padding:12px;
 background:#f8fafc;
 border-radius:10px;
 text-decoration:none;
 color:var(--primary);
 font-weight:600;
 margin-top:8px;
 transition:background 0.3s;
}
.websiteLink:hover{background:#e2e8f0}

/* Footer Actions */
.actions{
 display:flex;
 justify-content:space-around;
 padding:16px;
 background:var(--dark);
 position:sticky;
 bottom:0;
 z-index:100;
}
.actions a{
 color:#fff;
 font-size:22px;
 text-decoration:none;
 display:flex;
 align-items:center;
 justify-content:center;
 width:50px;
 height:50px;
 border-radius:50%;
 background:rgba(255,255,255,0.1);
 transition:background 0.3s;
 cursor:pointer;
}
.actions a:hover{background:rgba(255,255,255,0.2)}

/* Loading State */
#loading{
 position:fixed;
 top:0;
 left:0;
 right:0;
 bottom:0;
 background:rgba(255,255,255,0.9);
 display:flex;
 justify-content:center;
 align-items:center;
 z-index:1000;
 font-size:18px;
 color:#2563eb;
 flex-direction:column;
 gap:20px;
}
.spinner{
 width:40px;
 height:40px;
 border:4px solid #e2e8f0;
 border-top-color:#2563eb;
 border-radius:50%;
 animation:spin 1s linear infinite;
}
@keyframes spin{
 to{transform:rotate(360deg)}
}

/* Offer Panel */
#offerPanel{
 position:fixed;
 inset:0;
 background:#fff;
 z-index:1000;
 display:none;
 flex-direction:column;
}
.offerPanelHeader{
 display:flex;
 justify-content:space-between;
 align-items:center;
 padding:16px;
 background:var(--dark);
 color:white;
}
.offerPanelHeader h2{
 margin:0;
 font-size:18px;
}
.closePanel{
 background:none;
 border:none;
 color:white;
 font-size:24px;
 cursor:pointer;
}
.offerPanelImg{
 width:100%;
 height:200px;
 object-fit:contain;
 background:#f8fafc;
}
.offerPanelContent{
 padding:16px;
 flex:1;
 overflow-y:auto;
}
.offerPanelDesc{
 line-height:1.6;
 margin:12px 0;
}
.offerPanelPrice{
 font-size:20px;
 font-weight:700;
 color:var(--primary);
 margin:12px 0;
}
.panelActions{
 display:flex;
 gap:12px;
 margin-top:20px;
 position:sticky;
 bottom:0;
 background:white;
 padding:16px 0;
}
.panelCTA{
 padding:14px;
 text-align:center;
 border-radius:12px;
 font-weight:700;
 cursor:pointer;
 flex:1;
 border:none;
 font-size:16px;
}
.panelCTA.whatsapp{background:#25d366;color:#fff}
.panelCTA.cart{background:var(--primary);color:#fff}

/* Cart Panel */
.cartPanel{
 position:fixed;
 inset:0;
 background:#fff;
 z-index:1001;
 display:none;
 flex-direction:column;
}
.cartHeader{
 display:flex;
 justify-content:space-between;
 align-items:center;
 padding:16px;
 background:var(--dark);
 color:white;
}
.cartHeader h2{
 margin:0;
 font-size:18px;
 display:flex;
 align-items:center;
 gap:8px;
}
.closeCart{
 background:none;
 border:none;
 color:white;
 font-size:24px;
 cursor:pointer;
}
.cartItems{
 padding:16px;
 flex:1;
 overflow-y:auto;
}
.cartItem{
 display:flex;
 gap:12px;
 padding:12px;
 border-bottom:1px solid #e2e8f0;
 align-items:center;
}
.cartItem img{
 width:60px;
 height:60px;
 object-fit:cover;
 border-radius:8px;
}
.cartItemInfo{flex:1;}
.cartItemTitle{
 font-weight:600;
 margin-bottom:4px;
 font-size:14px;
}
.cartItemPrice{
 color:var(--primary);
 font-weight:600;
 font-size:14px;
}
.cartItemActions{
 display:flex;
 gap:8px;
 align-items:center;
}
.cartItemQty{
 display:flex;
 align-items:center;
 gap:6px;
}
.cartItemQty button{
 width:28px;
 height:28px;
 border-radius:6px;
 border:1px solid #cbd5e1;
 background:white;
 cursor:pointer;
 font-weight:bold;
}
.cartRemove{
 color:var(--danger);
 background:none;
 border:none;
 cursor:pointer;
 font-size:16px;
 padding:4px;
}
.cartFooter{
 padding:16px;
 background:#f8fafc;
 border-top:1px solid #e2e8f0;
}
.cartTotal{
 display:flex;
 justify-content:space-between;
 font-weight:600;
 font-size:18px;
 margin-bottom:16px;
 color:var(--dark);
}
.cartCheckout{
 background:var(--primary);
 color:white;
 border:none;
 padding:16px;
 width:100%;
 border-radius:12px;
 font-weight:600;
 cursor:pointer;
 font-size:16px;
}

/* Payment Modal */
.paymentModal{
 position:fixed;
 inset:0;
 background:rgba(0,0,0,0.5);
 z-index:1002;
 display:none;
 justify-content:center;
 align-items:center;
 padding:16px;
}
.paymentContent{
 background:white;
 padding:20px;
 border-radius:16px;
 max-width:400px;
 width:100%;
 max-height:80vh;
 overflow-y:auto;
}
.paymentHeader{
 display:flex;
 justify-content:space-between;
 align-items:center;
 margin-bottom:16px;
}
.paymentHeader h3{
 margin:0;
 color:var(--dark);
}
.closePayment{
 background:none;
 border:none;
 font-size:24px;
 cursor:pointer;
 color:#64748b;
}
.jazzcashQr{
 text-align:center;
 margin:16px 0;
}
.jazzcashQr img{
 max-width:200px;
 max-height:200px;
 border-radius:8px;
 border:1px solid #e2e8f0;
 padding:8px;
}
.jazzcashNumber{
 text-align:center;
 padding:16px;
 background:#f8fafc;
 border-radius:8px;
 margin:16px 0;
}
.jazzcashNumber code{
 font-size:18px;
 color:var(--primary);
 font-weight:600;
 display:block;
 margin:8px 0;
}
.paymentNote{
 font-size:12px;
 color:#64748b;
 margin-top:8px;
 text-align:center;
}
</style>
</head>

<body>

<div id="loading">
 <div class="spinner"></div>
 <div>Loading Digital Card...</div>
</div>

<div class="topbar">
 <a id="map"><i class="fa-solid fa-location-dot"></i></a>
 <a id="share"><i class="fa-solid fa-share-nodes"></i></a>
 <a id="cart"><i class="fa-solid fa-cart-shopping"></i></a>
</div>

<div class="profile">
 <img id="photo" src="" alt="Profile Picture">
 <div class="info">
  <div id="name"></div>
  <div id="business"></div>
  <div id="phone"><i class="fas fa-phone"></i> <span></span></div>
  <div id="email"><i class="fas fa-envelope"></i> <span></span></div>
  <div id="address"><i class="fas fa-map-marker-alt"></i> <span></span></div>
  <div id="websiteText" style="display:none"><i class="fas fa-globe"></i> <span></span></div>
 </div>
 <i class="fa fa-floppy-disk saveIcon" title="Save Contact"></i>
</div>

<div class="about" id="aboutBox">
 <div class="aboutText" id="aboutText"></div>
 <span class="aboutMore" id="aboutMore">See more</span>
</div>

<div id="sectionsContainer">
 <!-- Sections will be dynamically added here -->
</div>

<div class="offers" id="offersContainer">
 <!-- Offers will be added here -->
</div>

<div class="whatsappNote" id="whatsappNote">
 <strong><i class="fab fa-whatsapp"></i> Quick WhatsApp Message:</strong><br>
 Tap WhatsApp icon below to send message. Please mention your inquiry clearly for faster response.
</div>

<div class="actions">
 <a id="call" title="Call"><i class="fa fa-phone"></i></a>
 <a id="whatsappAction" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
 <a id="mail" title="Email"><i class="fa fa-envelope"></i></a>
</div>

<!-- Offer Details Panel -->
<div id="offerPanel">
 <div class="offerPanelHeader">
  <h2>Offer Details</h2>
  <button class="closePanel">×</button>
 </div>
 <img id="panelImg" class="offerPanelImg">
 <div class="offerPanelContent">
  <h2 id="panelTitle"></h2>
  <div id="panelPrice" class="offerPanelPrice"></div>
  <p id="panelDesc" class="offerPanelDesc"></p>
  <div class="panelActions">
   <button class="panelCTA whatsapp" id="panelWhatsApp"><i class="fab fa-whatsapp"></i> WhatsApp</button>
   <button class="panelCTA cart" id="panelCart"><i class="fas fa-cart-plus"></i> Add to Cart</button>
  </div>
 </div>
</div>

<!-- Cart Panel -->
<div class="cartPanel" id="cartPanel">
 <div class="cartHeader">
  <h2><i class="fas fa-shopping-cart"></i> Your Cart</h2>
  <button class="closeCart">×</button>
 </div>
 <div class="cartItems" id="cartItems">
  <div style="text-align:center;padding:40px;color:#64748b;">
   <i class="fas fa-shopping-cart" style="font-size:48px;margin-bottom:16px;opacity:0.3;"></i>
   <p>Your cart is empty</p>
  </div>
 </div>
 <div class="cartFooter">
  <div class="cartTotal">
   <span>Total:</span>
   <span id="cartTotalAmount">Rs 0</span>
  </div>
  <button class="cartCheckout">Proceed to Checkout</button>
 </div>
</div>

<!-- Payment Modal -->
<div class="paymentModal" id="paymentModal">
 <div class="paymentContent">
  <div class="paymentHeader">
   <h3><i class="fas fa-credit-card"></i> Payment Method</h3>
   <button class="closePayment">×</button>
  </div>
  <div id="paymentOptions">
   <!-- Payment options will be loaded here -->
  </div>
 </div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
document.addEventListener("DOMContentLoaded", async () => {
 // ============ YOUR SUPABASE CREDENTIALS ============
 const SUPABASE_URL = 'https://dfvnefbxgayxqgjjgtrr.supabase.co';
 const SUPABASE_KEY = 'sb_publishable_WypeFELCIlVDlqGY4PdWwA_snqoPUSE';
 // ===================================================
 
 console.log('Connecting to Supabase with URL:', SUPABASE_URL);
 
 const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
 
 // Get card ID from URL
 const urlParams = new URLSearchParams(window.location.search);
 const cardId = urlParams.get('id') || localStorage.getItem('lastCardId');
 
 if (!cardId) {
  document.body.innerHTML = `
   <div style="padding:40px;text-align:center;">
    <h2>No Digital Card Found</h2>
    <p style="color:#64748b;margin:20px 0;">Please scan a valid QR code or use a correct link</p>
    <button onclick="location.href='index.html'" style="background:#2563eb;color:white;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;">
     Create New Card
    </button>
   </div>
  `;
  return;
 }

 try {
  console.log('Fetching card with ID:', cardId);
  
  // Fetch card data from Supabase
  const { data, error } = await supabase
   .from('cards')
   .select('*')
   .eq('id', cardId)
   .single();

  if (error) {
   console.error('Supabase error:', error);
   throw new Error(`Database error: ${error.message}`);
  }

  if (!data || !data.data) {
   throw new Error('Invalid card data received');
  }

  const card = data.data;
  console.log("Loaded card data:", card);
  
  // Store for global access
  window.currentCard = card;
  window.cardId = cardId;
  window.cart = JSON.parse(localStorage.getItem(`cart_${cardId}`)) || [];
  
  // Hide loading
  document.getElementById('loading').style.display = 'none';
  
  // Populate card data
  populateCardData(card);
  
 } catch (error) {
  console.error("Error loading card:", error);
  document.getElementById('loading').innerHTML = `
   <div style="text-align:center;">
    <h3 style="color:#ef4444;">Error Loading Card</h3>
    <p>${error.message}</p>
    <div style="background:#fef2f2;padding:15px;border-radius:10px;margin:15px 0;max-width:400px;">
     <p><strong>Troubleshooting:</strong></p>
     <ul style="text-align:left;margin:10px 20px;">
      <li>Check if 'cards' table exists in Supabase</li>
      <li>Run app with Live Server (not file://)</li>
      <li>Check browser console for CORS errors</li>
      <li>Verify Supabase credentials are correct</li>
     </ul>
    </div>
    <button onclick="location.href='index.html'" style="background:#2563eb;color:white;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;margin-top:10px;">
     Create New Card
    </button>
   </div>
  `;
 }
});

function populateCardData(card) {
 // باقی تمام فنکشنز وہی رہیں گی جو پہلے تھیں
 // کوئی تبدیلی نہیں کی گئی
}

// باقی تمام JavaScript کوڈ وہی رہے گا جو آپ نے پہلے دیا تھا
// صرف اوپر والا credentials والا حصہ اپڈیٹ کیا گیا ہے
</script>
</body>
</html>
