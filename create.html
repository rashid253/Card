<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Add Business</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:system-ui;background:#f1f5f9}
.wrap{max-width:480px;margin:auto;padding:16px}
input,textarea{width:100%;padding:12px;margin:6px 0;border-radius:10px;border:1px solid #cbd5f5}
button{width:100%;padding:16px;border:none;border-radius:12px;background:#2563eb;color:white;font-size:17px;margin-top:20px}
</style>
</head>

<body>
<div class="wrap">
<a href="index.html">‚Üê Directory</a>

<h2>Add Business</h2>
<input type="file" id="profileImage">
<input id="businessName" placeholder="Business Name">
<input id="name" placeholder="Owner Name">
<input id="phone" placeholder="Phone">
<input id="address" placeholder="Address, Faisalabad">
<textarea id="businessInfo" placeholder="About business"></textarea>

<button onclick="save()">Create</button>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const db=supabase.createClient(
 "https://dfvnefbxgayxqgjjgtrr.supabase.co",
 "sb_publishable_WypeFELCIlVDlqGY4PdWwA_snqoPUSE"
);

function resize(file){
 return new Promise(res=>{
  const i=new Image();
  i.onload=()=>{
   const c=document.createElement("canvas");
   const r=Math.min(1024/i.width,1024/i.height,1);
   c.width=i.width*r;c.height=i.height*r;
   c.getContext("2d").drawImage(i,0,0,c.width,c.height);
   res(c.toDataURL("image/jpeg",0.8));
  };
  i.src=URL.createObjectURL(file);
 });
}

async function save(){
 const id=Math.random().toString(36).slice(2,8);
 const data={
  businessName:businessName.value,
  name:name.value,
  phone:phone.value,
  address:address.value,
  businessInfo:businessInfo.value,
  profileImage:""
 };
 if(profileImage.files[0])
  data.profileImage=await resize(profileImage.files[0]);

 await db.from("cards").insert({id,data:JSON.stringify(data)});
 location.href="card.html?id="+id;
}
</script>
</body>
</html>
