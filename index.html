<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Generate Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="style.css">
</head>

<body>
<div class="wrap">

<h2>Create Digital Card</h2>

<input id="name" placeholder="Full Name" required>
<input id="phone" placeholder="Phone" required>
<input id="email" placeholder="Email">
<input id="address" placeholder="Address">

<h3>Social Media</h3>
<input id="facebook" placeholder="Facebook link">
<input id="instagram" placeholder="Instagram link">
<input id="youtube" placeholder="YouTube link">

<h3>Offers (max 3)</h3>

<div id="offers"></div>
<button onclick="addOffer()">Add Offer</button>

<button onclick="generate()">Generate Card</button>

</div>

<script>
const SUPABASE_URL="https://dfvnefbxgayxqgjjgtrr.supabase.co";
const SUPABASE_KEY="sb_publishable_WypeFELCIlVDlqGY4PdWwA_snqoPUSE";

let offerCount=0;

function addOffer(){
 if(offerCount>=3)return;
 const box=document.createElement("div");
 box.innerHTML=`
  <input class="ot" placeholder="Title">
  <input class="od" placeholder="Description">
 `;
 offers.appendChild(box);
 offerCount++;
}

function uid(){
 return Math.random().toString(36).substr(2,7);
}

async function generate(){
 if(!name.value||!phone.value){
  alert("Name and phone required");
  return;
 }

 const data={
  name:name.value,
  phone:phone.value,
  email:email.value,
  address:address.value,
  facebook:facebook.value,
  instagram:instagram.value,
  youtube:youtube.value,
  offers:[]
 };

 document.querySelectorAll("#offers div").forEach(d=>{
  data.offers.push({
   title:d.querySelector(".ot").value,
   desc:d.querySelector(".od").value
  });
 });

 const id=uid();

 await fetch(SUPABASE_URL+"/rest/v1/cards",{
  method:"POST",
  headers:{
   "apikey":SUPABASE_KEY,
   "Content-Type":"application/json"
  },
  body:JSON.stringify({id:id,data:JSON.stringify(data)})
 });

 location.href="card.html?id="+id;
}
</script>
</body>
</html>
